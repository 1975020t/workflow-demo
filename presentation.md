# XYZシステム ヘルプデスク AIエージェント

## 1. 背景

企業の社内ヘルプデスクでは、パスワードリセットや操作手順の確認など、マニュアルやFAQで回答可能な定型的な問い合わせが大半を占める。しかし、対応する担当者のリソースは限られており、回答品質にもばらつきが生じやすい。

一方、LLMを単体で利用するだけでは、社内固有の情報を正確に回答できない（ハルシネーション）という課題がある。そこで、**社内ナレッジからの情報検索とLLMによる回答生成を組み合わせたワークフロー型エージェント**を構築することで、この問題を解決する。

## 2. 目的

- ユーザーからの問い合わせに対し、蓄積された社内ナレッジをもとに**正確な回答を自動生成**する
- LLMのプロンプト制御により、**一貫した品質の回答**を提供する
- データソースやステップの追加に柔軟に対応できる**拡張可能な設計**を実現する

## 3. 業務フロー

ユーザーの質問から回答に至るまでの業務フローを以下の4ステップで設計した。

```
質問の受付 → 質問の意図を分析 → 社内データから情報を検索 → 関連情報を選別 → 回答を生成
```

| ステップ | 処理内容 | 実行方式 |
|---|---|---|
| 質問分析 | キーワード抽出とドメイン（account / project / report / system）の判定 | LLM |
| データ検索 | 判定されたドメインのナレッジベース（CSV）からキーワードで検索 | プログラム |
| データ絞り込み | 検索結果から質問に関連する情報のみを選別 | LLM |
| 回答生成 | 絞り込まれた情報をもとに自然言語で回答を作成 | LLM |

LLMによる意味理解が必要な処理と、確実性が求められる検索処理を分離している点がポイントとなる。

## 4. ワークフロー型デザイン

LangGraphの`StateGraph`による線形パイプライン。

```
 [START]
    │
    ▼
 ┌─────────────────────┐
 │  analyze_question    │  LLM（Structured Output）
 │  キーワード抽出 +    │
 │  ドメインルーティング │
 └──────────┬──────────┘
            │  keywords, data_source
            ▼
 ┌─────────────────────┐
 │  search_data         │  プログラム
 │  該当CSVを           │
 │  キーワード検索      │─────── account → ds_account.csv
 │                      │─────── project → ds_project.csv
 │                      │─────── report  → ds_report.csv
 │                      │─────── system  → ds_system.csv
 └──────────┬──────────┘
            │  search_results
            ▼
 ┌─────────────────────┐
 │  filter_results      │  LLM（Structured Output）
 │  関連情報の選別      │
 │  0件→フォールバック  │
 └──────────┬──────────┘
            │  filtered_data
            ▼
 ┌─────────────────────┐
 │  generate_answer     │  LLM
 │  最終回答の生成      │
 │  ※フォールバック時は │
 │    スキップ          │
 └──────────┬──────────┘
            │  answer
            ▼
  [END]
```

全エッジは無条件接続。フォールバック制御はノード内部のガード条件で行う。

